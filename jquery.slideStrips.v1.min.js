//*******************************************************************************************************
//
// Copyright 2013 Eric J. Basti
// http://www.ericjbasti.com
//
// Released under the MIT license
// 
//*******************************************************************************************************
(function(c){function b(e){for(var d=0;d<e.length;d++){if(document.createElement("div").style[e[d]]!==undefined){return e[d]}}return false}function a(){var d=document.createElement("div");d.setAttribute("ontouchstart","return;");if(typeof d.ontouchstart=="function"){return true}return false}c.fn.slideStrip=function(d){var e={start:0,pause:5,autoPlay:true,slide:false,touch:true,controls:null,trueFit:true,slingBack:false,threshold:20,fallBacks:{fadeTime:0.5,slideTime:0.5},onSlideChange:function(){}};d=c.extend(e,d);return this.each(function(){var j=this;var i=null;var s=c(this).wrap("<div class='slideStrip'>").parent();var t=c(this).find("li");if(d.controls=="add"){c(s).append('<div class="controls"></div>');i=c(s).find(".controls")}var g=d.start;var p=null;var A=!d.autoPlay;var z=0;var B=0;var C=1;var k=1;var l=c(j).prepend("<li class='sp_invisible' style='visibility:hidden;position:relative;'>"+c(t[g]).html()+"</li>");var q=b(["transform","WebkitTransform","MozTransform","OTransform","msTransform"]);var w=b(["transition","WebkitTransition","MozTransition","OTransition","msTransition"]);if(d.slide){c(t).each(function(E){c(this).css("left",(E*100)+"%")})}var o=function(H){if(!q){c(j).clearQueue()}c(t).removeClass("active");for(var F=0;F!=k;F++){c(t[H+F]).addClass("active");var E=c(t[H+F]).find("img");if(c(E).attr("ref")&&c(E).attr("ref")!=c(E).attr("src")){c(E).attr("src",c(E).attr("ref"))}}if(d.slide){var G=-(H*100);if(d.trueFit){if(H+k>t.length-1){G=-z;g=(Math.round(G/100))*-1}}if(w){j.style[q]="translateX("+G+"%)"}else{if(q){c(j).animate({transform:G},{step:function(I){c(this).css("-ms-transform","translateX("+I+"%)")}},d.fallBacks.slideTime*1000)}else{console.log("ie8");c(j).animate({left:G/C+"%"},d.fallBacks.slideTime*1000)}}}else{if(!d.slide&&!w){c(t).fadeOut(d.fallBacks.fadeTime);c(t[H]).fadeIn(d.fallBacks.fadeTime)}}if(i){c(i).find(".button").removeClass("active");if(d.trueFit){H=Math.round((H/k)+0.4)*k}c(i).find(".button[name="+H+"]").addClass("active");if(g>=t.length-k){c(i).find(".button:last-child").addClass("active")}}};var y=function(E){o(g);d.onSlideChange(g,t.length-k);clearTimeout(p);if(E){}else{p=setTimeout(function(){h()},d.pause*1000)}};var h=function(){g+=k;if(g-(k/2)>t.length-k){if(d.slingBack){g=0}else{g=t.length-k}}y(A)};var D=function(){g-=k;if(g<0){if(d.slingBack&&g<=-k){g=t.length-k}else{g=0}}y(A)};var r=function(){if(i){var G="";var F=0;for(var E=0;E<t.length;E+=k){G+='<div class="button" name="'+E+'"></div>';F++}if(F==1){c(i).html("")}else{c(i).html(G);c(i).find(".button").click(function(){var H=parseFloat(c(this).attr("name"));g=H;y(A)})}}};var x=function(){C=c(s).width()/c(j).width();k=Math.floor(C)||1;if(C-k>0.95){k++}};var v=function(){if(d.slide){x()}r();y(A)};if(d.touch){s.addClass("touch");var m={active:false,x:0,y:0,deltaX:0,deltaY:0};var u={width:0,x:0,y:0};var f=0;var n=function(F){if(navigator.msMaxTouchPoints){F.preventDefault()}if(!F){F=window.event}var H=function(I){if(q){u.x=parseFloat((j.style[q]).replace("translateX(",""));c(j).addClass("accelerate")}else{c(j).clearQueue();u.x=parseFloat(j.style.left)}u.width=c(j).find(".active").width();f=0;m.active=true;m.x=parseFloat(I.clientX);m.y=parseFloat(I.clientY);m.deltaX=m.deltaY=0;clearTimeout(p);A=true;if(w){j.style[w+"Duration"]="0s"}if(I.type=="mousedown"){if(I.preventDefault){I.preventDefault()}else{}}};var G=function(I,J){if(m.active){m.deltaX=m.x-parseFloat(I.clientX);m.deltaY=m.y-parseFloat(I.clientY);f=(m.deltaX/u.width)*100;if(!q){f=f/C}if(d.slide&&t.length>k){var K=u.x-f;if(K>0){K=K/4}if(q){if(K<=-z){if(u.x>-z+25){K=-z+25-(f*0.25)}else{K=-z-(f*0.25)}}j.style[q]="translateX("+K+"%)"}else{if(K<=-(z-(k*100))){K=-z+(k*100)-(f*0.25)}c(j).css({left:K+"%"})}}if(m.deltaX>=10||m.deltaX<=-10){if(J.preventDefault){J.preventDefault()}else{window.event.returnValue=false;window.event.cancelBubble=true}c(j).addClass("moving")}}};var E=function(J){if(w){j.style[w+"Duration"]=""}var K;var I=d.threshold;if(!q){I=I/C}if(f>I){h()}else{if(f<-I){D()}else{o(g)}}m.active=false;if(f>=5||f<=-5){setTimeout(function(){c(j).removeClass("moving")},100)}else{return true}};if(F.type){switch(F.type){case"mousemove":G(F,F);break;case"mouseup":E(F);break;case"mousedown":H(F);break;case"touchstart":H(F.targetTouches[0]);break;case"touchmove":G(F.targetTouches[0],F);break;case"touchend":E(F.targetTouches[0]);break;case"touchcancel":E(F.targetTouches[0]);break;case"touchleave":E(F.targetTouches[0]);break;case"MSPointerMove":G(F,F);break;case"MSPointerUp":E(F);break;case"MSPointerDown":H(F);break;case"MSPointerCancel":E(F);break;case"MSPointerOut":E(F);break}}};if(d.touch){j.onmousedown=n;j.onmouseup=n;j.onmousemove=n;if(a){j.ontouchstart=n;j.ontouchmove=n;j.ontouchend=n;j.ontouchcancel=n;j.ontouchleave=n}}}c(this).bind("loadSlide",function(E,F){if(g!=F){g=F;o(g)}});c(this).bind("play",function(E,F){y(F)});c(this).bind("nextSlide",function(E){h()});c(this).bind("previousSlide",function(E){D()});if(d.slide){c(window).resize(function(){if(d.slide){x()}r();g=0;y(true);z=(t.length*100)-(C*100)});setTimeout(function(){c(window).trigger("resize");c(j).addClass("accelerate")},500)}v()})}})(jQuery);